swagger: '2.0'
info:
  title: atb-bff
  description: ATB BFF
  version: 1.0.0
host: atb-bff-p7kz45bx3q-ew.a.run.app
schemes:
  - https
produces:
  - application/json
x-google-backend:
  address: https://atb-bff-p7kz45bx3q-ew.a.run.app
  path_translation: APPEND_PATH_TO_ADDRESS
paths:
  /bff/v1/departures-realtime:
    get:
      summary:
        Get updated realtime information of all lines and quays passed as data
      operationId: getBffV1Departuresrealtime
      parameters:
        - type: array
          default: []
          items:
            type: string
          collectionFormat: multi
          name: quayIds
          in: query
        - type: string
          format: date
          name: startTime
          in: query
        - type: number
          default: 5
          name: limit
          in: query
        - type: array
          items:
            type: string
          collectionFormat: multi
          name: lineIds
          in: query
        - type: number
          name: limit
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
  /bff/v1/geocoder/features:
    get:
      summary: Find features matching query
      operationId: getBffV1GeocoderFeatures
      parameters:
        - type: string
          name: query
          in: query
          required: true
        - type: number
          name: lon
          in: query
        - type: number
          name: lat
          in: query
        - type: string
          name: layers
          in: query
        - type: string
          name: tariff_zone_authorities
          in: query
        - type: number
          name: boundary.rect.min_lat
          in: query
        - type: number
          name: boundary.rect.max_lat
          in: query
        - type: number
          name: boundary.rect.min_lon
          in: query
        - type: number
          name: boundary.rect.max_lon
          in: query
        - type: string
          name: country
          in: query
        - type: string
          name: sources
          in: query
        - type: number
          name: limit
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v1/geocoder/reverse:
    get:
      summary: 'Find addresses, POIs and stop places near the given coordinates'
      operationId: getBffV1GeocoderReverse
      parameters:
        - type: number
          name: lat
          in: query
          required: true
        - type: number
          name: lon
          in: query
          required: true
        - type: string
          name: layers
          in: query
        - type: number
          name: radius
          in: query
        - type: number
          name: limit
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v1/journey/trip:
    post:
      summary: Find trip patterns
      operationId: postBffV1JourneyTrip
      parameters:
        - in: body
          name: body
          schema:
            $ref: '#/definitions/Model5'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
  '/bff/v1/servicejourney/{id}/departures':
    get:
      summary: Get departures for Service Journey
      operationId: getBffV1ServicejourneyIdDepartures
      parameters:
        - type: string
          name: id
          in: path
          required: true
        - type: string
          format: date
          name: date
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  '/bff/v1/servicejourney/{id}/polyline':
    get:
      summary: Get Map info for Service Journey
      operationId: getBffV1ServicejourneyIdPolyline
      parameters:
        - type: string
          name: id
          in: path
          required: true
        - type: string
          name: fromQuayId
          in: query
        - type: string
          name: toQuayId
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
  '/bff/v2/servicejourney/{id}/departures':
    get:
      summary: Get departures for Service Journey
      operationId: getBffV2ServicejourneyIdDepartures
      parameters:
        - type: string
          name: id
          in: path
          required: true
        - type: string
          format: date
          name: date
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  '/bff/v2/servicejourney/{id}/calls':
    get:
      summary: Get ServiceJourney including EstimatedCalls
      operationId: getBffV2ServicejourneyIdCalls
      parameters:
        - type: string
          name: id
          in: path
          required: true
        - type: string
          format: date
          name: date
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  '/bff/v2/servicejourney/{id}/polyline':
    get:
      summary: Get Map info for a serviceJourney
      operationId: getBffV2ServicejourneyIdPolyline
      parameters:
        - type: string
          name: id
          in: path
          required: true
        - type: string
          name: fromQuayId
          in: query
        - type: string
          name: toQuayId
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v1/departures-grouped:
    post:
      summary: Get departures grouped on lines from feature location
      operationId: postBffV1Departuresgrouped
      parameters:
        - type: number
          default: 5
          name: limitPerLine
          in: query
        - type: string
          format: date
          default: '2021-01-27T09:48:19.354Z'
          name: startTime
          in: query
        - type: number
          default: 3
          name: pageSize
          in: query
        - type: string
          name: cursor
          in: query
        - in: body
          name: body
          schema:
            $ref: '#/definitions/Model4'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departure-favorites:
    post:
      summary: Get departures favorites grouped on lines
      operationId: postBffV2DeparturesFavorites
      parameters:
        - type: number
          default: 5
          name: limitPerLine
          in: query
        - type: string
          format: date
          default: '2021-01-27T09:48:19.354Z'
          name: startTime
          in: query
        - type: number
          default: 3
          name: pageSize
          in: query
        - type: boolean
          name: includeCancelledTrips
          in: query
        - type: string
          name: cursor
          in: query
        - in: body
          name: body
          schema:
            $ref: '#/definitions/departureFavoritesPayload'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v1/enrollment/group:
    post:
      summary: Enroll in beta groups with invite key
      operationId: postBffV1EnrollmentGroup
      parameters:
        - type: string
          name: inviteKey
          in: query
          required: true
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departures/departures:
    post:
      summary: Get departures for a list of quays
      operationId: postBffV2Departures
      parameters:
        - type: array
          items:
            type: string
          collectionFormat: multi
          name: ids
          in: query
          required: true
        - type: number
          name: numberOfDepartures
          default: 10
          in: query
        - type: string
          format: date
          name: startTime
          in: query
        - type: number
          name: timeRange
          in: query
        - in: body
          name: body
          schema:
            $ref: '#/definitions/departuresPayload'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departures/stops-nearest:
    get:
      summary: Get stops geographically nearest to a set of coordinates
      operationId: getBffV2StopsNearest
      parameters:
        - type: number
          name: latitude
          in: query
          required: true
        - type: number
          name: longitude
          in: query
          required: true
        - type: number
          name: distance
          default: 1000
          in: query
        - type: number
          name: count
          default: 10
          in: query
        - type: string
          name: after
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departures/stops-details:
    get:
      summary: Get details for stop places
      operationId: getBffV2StopsDetails
      parameters:
        - type: array
          default: []
          items:
            type: string
          collectionFormat: multi
          name: ids
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departures/stop-departures:
    get:
      summary: Get stop with departures for every quay
      operationId: getBffV2StopDepartures
      parameters:
        - type: string
          name: id
          in: query
          required: true
        - type: number
          name: numberOfDepartures
          default: 10
          in: query
        - type: string
          format: date
          default: '2021-01-27T09:48:19.354Z'
          name: startTime
          in: query
        - type: number
          name: timeRange
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
    post:
      summary: Get stop with departures for every quay
      operationId: postBffV2StopDepartures
      parameters:
        - type: string
          name: id
          in: query
          required: true
        - type: number
          name: numberOfDepartures
          default: 10
          in: query
        - type: string
          format: date
          name: startTime
          in: query
        - type: number
          name: timeRange
          in: query
        - in: body
          name: body
          schema:
            $ref: '#/definitions/departuresPayload'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
  /bff/v2/quays-coordinates:
    post:
      summary: Get quays coordinates
      operationId: getBffV2QuayCoordinates
      parameters:
        - in: body
          name: body
          schema:
            $ref: '#/definitions/quayCoordinatesPayload'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/departures/quay-departures:
    get:
      summary: Get departures from a quay
      operationId: getBffV2QuayDepartures
      parameters:
        - type: string
          name: id
          in: query
          required: true
        - type: number
          name: numberOfDepartures
          default: 5
          in: query
        - type: string
          format: date
          default: '2021-01-27T09:48:19.330Z'
          name: startTime
          in: query
        - type: number
          name: timeRange
          default: 86400
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
    post:
      summary: Get departures from a quay
      operationId: postBffV2QuayDepartures
      parameters:
        - type: string
          name: id
          in: query
          required: true
        - type: number
          name: numberOfDepartures
          default: 1000
          in: query
        - type: string
          format: date
          name: startTime
          in: query
        - type: number
          name: timeRange
          default: 86400
          in: query
        - in: body
          name: body
          schema:
            $ref: '#/definitions/departuresPayload'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
      deprecated: true
  /bff/v2/departures/realtime:
    get:
      summary: Get updated realtime information for the given quays
      operationId: getBffV2Departuresrealtime
      parameters:
        - type: array
          default: []
          items:
            type: string
          collectionFormat: multi
          name: quayIds
          in: query
        - type: string
          format: date
          name: startTime
          in: query
        - type: number
          default: 5
          name: limit
          in: query
        - type: array
          items:
            type: string
          collectionFormat: multi
          name: lineIds
          in: query
        - type: number
          name: limit
          in: query
        - type: number
          name: timeRange
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/stop-places:
    get:
      summary: Get stop places by authority and modes
      operationId: getBffV2StopPlaces
      parameters:
        - type: array
          default: []
          items:
            type: string
          collectionFormat: multi
          name: authorities
          in: query
          required: true
        - type: array
          default: [ ]
          items:
            type: string
          collectionFormat: multi
          name: transportModes
          in: query
        - type: array
          default: [ ]
          items:
            type: string
          collectionFormat: multi
          name: transportSubmodes
          in: query

      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/stop-places/connections:
    get:
      summary: Get stop with connecting lines from from-harbor
      operationId: getBffV2StopPlacesConnections
      parameters:
        - type: string
          name: fromHarborId
          in: query
          required: true
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/trips:
    post:
      summary: Get trips between stops
      operationId: postBffV2_0Trips
      parameters:
        - in: body
          name: body
          schema:
            $ref: '#/definitions/TripsModel'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/singleTrip:
    post:
      summary: get details for a single trip
      operationId: postBffV2_0SingleTrip
      parameters:
        - in: body
          name: body
          schema:
            $ref: '#/definitions/SingleTripModel'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/v2/vehicles/service-journeys:
    get:
      summary: Get vehicle information for a list of service journeys
      operationId: getBffVehiclesServiceJourneys
      parameters:
        - type: array
          items:
            type: string
          name: serviceJourneyIds
          in: query
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/login/vipps/authorization-url:
    get:
      summary: Get Vipps authorisation url
      operationId: getVippsAuthUrl
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful
  /bff/login/vipps/user-custom-token:
    post:
      summary: Get Vipps user custom token
      operationId: getUserCustomToken
      parameters:
        - in: body
          name: body
          schema:
            $ref: '#/definitions/VippsLoginRequest'
      tags:
        - bff
      responses:
        default:
          schema:
            type: string
          description: Successful

definitions:
  coordinates:
    type: object
    properties:
      longitude:
        type: number
      latitude:
        type: number
  Model1:
    type: object
    properties:
      layer:
        type: string
      id:
        type: string
      coordinates:
        $ref: '#/definitions/coordinates'
  Model2:
    type: object
    properties:
      layer:
        type: string
        enum:
          - override: true
          - venue
      id:
        type: string
  Model3:
    type: object
    properties:
      stopId:
        type: string
      lineName:
        type: string
      lineId:
        type: string
    required:
      - stopId
      - lineName
      - lineId
  favorites:
    type: array
    items:
      $ref: '#/definitions/Model3'
  Model4:
    type: object
    properties:
      location:
        $ref: '#/definitions/Model2'
        x-alternatives:
          - $ref: '#/x-alt-definitions/location'
          - $ref: '#/x-alt-definitions/Model1'
      favorites:
        $ref: '#/definitions/favorites'
    required:
      - location
  departuresPayload:
    type: object
    properties:
      favorites:
        $ref: '#/definitions/favoritesV2'
    required:
      - location
  quayCoordinatesPayload:
    type: object
    properties:
      ids:
        type: array
        items:
          type: string
  departureFavoritesPayload:
    type: object
    properties:
      favorites:
        $ref: '#/definitions/favoritesV2'
  favoritesV2:
    type: array
    items:
      $ref: '#/definitions/favoriteV2'
  favoriteV2:
    type: object
    properties:
      stopId:
        type: string
        example: 'NSR:StopPlace:41613'
      lineName:
        type: string
        example: 'Lund via Kolstad-Heimdal'
      lineId:
        type: string
        example: 'ATB:Line:2_2'
      quayId:
        type: string
        example: 'NSR:Quay:71184'
    required:
      - stopId
      - lineName
      - lineId
  from:
    type: object
    properties:
      place:
        type: string
      name:
        type: string
        default: UNKNOWN
      coordinates:
        $ref: '#/definitions/coordinates'
  modes:
    type: array
    default:
      - foot
      - bus
      - tram
      - rail
      - metro
      - water
      - air
    items:
      type: string
  modes_jp3:
    type: object
    properties:
      directMode:
        type: string
  Model5:
    type: object
    properties:
      from:
        $ref: '#/definitions/from'
      to:
        $ref: '#/definitions/from'
      searchDate:
        type: string
        format: date
      arriveBy:
        type: boolean
        default: false
      minimumTransferTime:
        type: number
        default: 30
      modes:
        $ref: '#/definitions/modes'
      limit:
        type: number
        default: 10
      wheelchairAccessible:
        type: boolean
        default: false
    required:
      - from
      - to
  TripsModel:
    type: object
    properties:
      from:
        $ref: '#/definitions/from'
      to:
        $ref: '#/definitions/from'
      when:
        type: string
        format: date
      arriveBy:
        type: boolean
      cursor:
        type: string
      transferPenalty:
        type: number
      waitReluctance:
        type: number
      walkReluctance:
        type: number
      walkSpeed:
        type: number
      modes:
        $ref: '#/definitions/modes_jp3'
    required:
      - from
      - to
      - arriveBy
  SingleTripModel:
    type: object
    properties:
      compressedQuery:
        type: string
    required:
      - compressedQuery
  VippsLoginRequest:
    type: object
    properties:
      authorizationCode:
        type: string
      state:
        type: string
      nonce:
        type: string
    required:
      - authorizationCode
      - state
      - nonce
x-alt-definitions:
  location:
    type: object
    properties:
      layer:
        type: string
        enum:
          - override: true
          - venue
      id:
        type: string
  coordinates:
    type: object
    properties:
      longitude:
        type: number
      latitude:
        type: number
  Model1:
    type: object
    properties:
      layer:
        type: string
        enum:
          - override: true
          - address
      coordinates:
        $ref: '#/x-alt-definitions/coordinates'
