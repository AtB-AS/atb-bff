# AtB BFF (oneclick-journey-planner)

Provides HTTP REST endpoints for consuming Entur services from mobile / web
applications. Built as a docker image and runs on GCP.

API documentation is generated at runtime and lives in `/documentation`
(Swagger).

## Installation

Clone this project:

`git clone https://github.com/atb-as/bff-oneclick-planner.git`

Build and run the docker image:

`docker run --rm --env PORT=8080 -p 8080:8080 -it $(docker build -q .)`

## Architecture

The runtime is written in TypeScript and runs on Node.js

- HTTP server framework: [Hapi](https://hapi.dev)
  - Request and response validation is performed by
    [Joi](https://hapi.dev/family/joi/)
  - Swagger documentation is generated by
    [hapi-swagger](https://github.com/glennjones/hapi-swagger)
- Testing framework: [Jest](https://jestjs.io/)

Hapi was chosen because it is battle-tested, has a magnitude of features
supported out of the box, and has few external dependencies. Most of its
dependencies are handled by the same team that maintains Hapi.

Service interfaces lives in `service/`, implementations in `service/impl`

API endpoints live in `api/`.

The current implementation uses [@entur/sdk](https://github.com/entur/sdk) as an
abstraction on top of Entur's GraphQL endpoints.

## GraphQL Code Generation

For endpoints that uses GraphQL directly we generate types and code using
`graphql-code-gen`. If the queries, scheme, operations or fragments change,
generate the code using scripts:

```
npm run gql-gen
```

This will make a TypeScript representation of the `.graphql` file in the same
location but with `.graphql-gen.ts` extension. You can use these directly as
queries.
